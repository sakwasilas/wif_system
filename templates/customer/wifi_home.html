{% extends "base.html" %}

{% block content %}
<div class="container d-flex justify-content-center align-items-center" style="min-height: 90vh;">
    <div class="card shadow-lg border-0" style="width: 100%; max-width: 600px; background-color: #f8f9fa;">

        <!-- ==================== CARD HEADER ==================== -->
        <div class="card-header text-white 
            {% if status == 'active' and days_left and days_left <= 3 %}bg-warning
            {% elif status == 'active' %}bg-success
            {% elif status == 'grace' %}bg-warning
            {% elif status == 'suspended' %}bg-danger
            {% else %}bg-secondary
            {% endif %}">
            
            <div class="text-center">
                <h4 class="mb-1">Intersurf Cable Ltd - {{ customer.name }}</h4>
                {% if status == 'active' %}
                    <h5 class="mb-2">Your subscription is active</h5>
                {% elif status == 'grace' %}
                    <h5 class="mb-2 text-warning">Subscription in Grace Period</h5>
                {% elif status == 'suspended' %}
                    <h5 class="mb-2 text-danger">Subscription Suspended</h5>
                {% endif %}
                <hr>
            </div>
        </div>

        <!-- ==================== CARD BODY ==================== -->
        <div class="card-body text-center">

            {# ===== Newly Added / Active Customer ===== #}
            {% if status == "active" %}
                <p class="fw-bold">{{ short_message }}</p>
                {% if detailed_message %}
                    <p class="fs-5">{{ detailed_message|safe }}</p>
                {% else %}
                    <p class="fs-5">Your subscription runs from <strong>{{ customer.start_date.strftime("%Y-%m-%d") }}</strong> 
                    to <strong>{{ (customer.start_date + timedelta(days=30)).strftime("%Y-%m-%d") }}</strong>.</p>
                {% endif %}

                {% if days_left and days_left <= 3 %}
                    <p class="fw-bold text-warning">Your WiFi will expire in {{ days_left }} day{% if days_left > 1 %}s{% endif %}.</p>
                    <form method="GET" action="{{ url_for('wifi_access', ip_address=customer.ip_address) }}">
                        <input type="hidden" name="paid" value="true">
                        <button type="submit" class="btn btn-success w-100">Pay Now</button>
                    </form>
                {% endif %}

            {# ===== Grace Period ===== #}
            {% elif status == "grace" %}
                <p class="fw-bold">{{ short_message }}</p>
                {% if not customer.grace_days_requested %}
                    <form method="POST" action="{{ url_for('grace_popup', ip_address=customer.ip_address) }}" class="mt-4">
                        <div class="mb-3">
                            <label for="grace_days" class="form-label fw-bold">Select Grace Days (1-5):</label>
                            <select name="grace_days" id="grace_days" class="form-select" required>
                                {% for i in range(1, 6) %}
                                    <option value="{{ i }}">{{ i }} Day{% if i > 1 %}s{% endif %}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <button type="submit" class="btn btn-warning w-100">Request Grace Period</button>
                    </form>
                {% endif %}
                <form method="GET" action="{{ url_for('wifi_access', ip_address=customer.ip_address) }}" class="mt-3">
                    <input type="hidden" name="paid" value="true">
                    <button type="submit" class="btn btn-success w-100">Pay Now & Resume WiFi</button>
                </form>

            {# ===== Suspended ===== #}
            {% elif status == "suspended" %}
                <p class="fw-bold">{{ short_message }}</p>
                {% if detailed_message %}
                    <p class="fs-5">{{ detailed_message|safe }}</p>
                {% endif %}
            {% endif %}

        </div>

        <!-- ==================== CARD FOOTER ==================== -->
        <div class="card-footer text-muted text-center">
            &copy; {{ current_year }} Intersurf Cable Ltd. All rights reserved.
        </div>

    </div>
</div>
{% endblock %}
