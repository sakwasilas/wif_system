<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --bg: #f6f7fb;
      --panel: #ffffff;
      --text: #0f172a;
      --muted: #64748b;
      --line: #e8edf5;
      --shadow: 0 10px 25px rgba(15, 23, 42, .08);
      --shadow-sm: 0 6px 16px rgba(15, 23, 42, .06);
    }
    body{
      background: var(--bg);
      font-family: "Segoe UI", system-ui, -apple-system, Arial, sans-serif;
      color: var(--text);
    }

    /* App layout */
    .app{
      display:flex;
      min-height:100vh;
    }

    /* Sidebar */
    .sidebar{
      width: 270px;
      background: var(--panel);
      border-right: 1px solid var(--line);
      position: sticky;
      top: 0;
      height: 100vh;
      padding: 18px 14px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 14px;
      background: linear-gradient(135deg, #111827, #0b1220);
      color: #fff;
      box-shadow: var(--shadow-sm);
      margin-bottom: 14px;
    }
    .brand .logo{
      width: 38px; height: 38px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.12);
      font-weight:900;
    }
    .brand .title{
      line-height: 1.1;
    }
    .brand .title strong{
      display:block;
      font-size: 14px;
      letter-spacing:.2px;
    }
    .brand .title span{
      font-size: 12px;
      opacity: .8;
    }

    .side-section{
      margin-top: 14px;
      margin-bottom: 10px;
      font-size: 11px;
      letter-spacing:.12em;
      text-transform: uppercase;
      color: var(--muted);
      padding: 0 10px;
      font-weight: 700;
    }

    .side-link{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 12px;
      text-decoration:none;
      color: var(--text);
      font-weight: 600;
      margin-bottom: 6px;
      border: 1px solid transparent;
      transition: .15s ease;
    }
    .side-link:hover{
      background: #f1f5ff;
      border-color: #dbe7ff;
      transform: translateY(-1px);
    }
    .side-link .ico{
      width: 34px; height: 34px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      background: #f1f5f9;
      color: #111827;
      font-size: 16px;
    }

    .side-mini{
      margin-top: 12px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: #fbfcff;
    }

    /* Content */
    .content{
      flex: 1;
      padding: 18px 22px;
    }

    /* Top bar */
    .topbar{
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 14px 16px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      box-shadow: var(--shadow-sm);
    }
    .user-chip{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .avatar{
      width: 42px; height: 42px;
      border-radius: 14px;
      background: linear-gradient(135deg, #0d6efd, #22c55e);
      display:grid;
      place-items:center;
      color:#fff;
      font-weight: 900;
    }
    .user-chip .meta{
      line-height: 1.2;
    }
    .user-chip .meta .name{
      font-weight: 800;
    }
    .user-chip .meta .role{
      font-size: 12px;
      color: var(--muted);
    }

    /* KPI Cards */
    .kpi{
      border-radius: 16px;
      padding: 14px 14px;
      background: var(--panel);
      border: 1px solid var(--line);
      box-shadow: var(--shadow-sm);
      transition: .15s ease;
      cursor: pointer;
      height: 100%;
    }
    .kpi:hover{ transform: translateY(-2px); }
    .kpi .label{ color: var(--muted); font-weight: 700; font-size: 12px; letter-spacing:.03em; }
    .kpi .value{ font-size: 26px; font-weight: 900; margin-top: 4px; }
    .kpi .hint{ font-size: 12px; color: var(--muted); margin-top: 6px; }

    .kpi.active{ border-left: 6px solid #22c55e; }
    .kpi.grace{ border-left: 6px solid #f59e0b; }
    .kpi.suspended{ border-left: 6px solid #ef4444; }
    .kpi.pending{ border-left: 6px solid #0d6efd; }
    .kpi.total{ border-left: 6px solid #111827; }

    /* Panels */
    .panel{
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 16px;
      box-shadow: var(--shadow-sm);
    }
    .panel .panel-head{
      padding: 14px 16px;
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content: space-between;
    }
    .panel .panel-head h5{
      margin:0;
      font-weight: 900;
      font-size: 15px;
    }
    .panel .panel-body{
      padding: 16px;
    }

    .btn-soft{
      border-radius: 12px;
      font-weight: 700;
      padding: 10px 12px;
    }

    footer{
      color: var(--muted);
      margin: 18px 0 10px;
      text-align:center;
      font-size: 12px;
    }
  </style>
</head>

<body>
<div class="app">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="brand">
      <div class="logo">üì∂</div>
      <div class="title">
        <strong>WiFi Management</strong>
        <span>ISP Control Panel</span>
      </div>
    </div>

    <div class="side-section">Management</div>
    <a class="side-link" href="{{ url_for('admin_users') }}">
      <div class="ico">üë•</div>
      <div>User Management</div>
    </a>
    <a class="side-link" href="{{ url_for('add_customer') }}">
      <div class="ico">‚ûï</div>
      <div>Add Customer</div>
    </a>
    <a class="side-link" href="{{ url_for('list_customers') }}">
      <div class="ico">üìã</div>
      <div>Customers</div>
    </a>
    <a class="side-link" href="{{ url_for('monthly_report') }}">
      <div class="ico">üìä</div>
      <div>Reports</div>
    </a>

    <div class="side-section">Network</div>
    <a class="side-link" href="{{ url_for('add_branch') }}">
      <div class="ico">üè¢</div>
      <div>Add Branch</div>
    </a>
    <a class="side-link" href="{{ url_for('list_branches') }}">
      <div class="ico">üè¢</div>
      <div>View Branches</div>
    </a>
    <a class="side-link" href="{{ url_for('add_router') }}">
      <div class="ico">üñß</div>
      <div>Add Router</div>
    </a>
    <a class="side-link" href="{{ url_for('list_routers') }}">
      <div class="ico">üñß</div>
      <div>View Routers</div>
    </a>

    <div class="side-mini mt-3">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <div class="fw-bold" style="font-size:13px;">Signed in</div>
          <div class="text-muted" style="font-size:12px;">{{ username }} ({{ session.get('role') }})</div>
        </div>
        <a href="{{ url_for('logout') }}" class="btn btn-outline-dark btn-sm" style="border-radius:12px;">Logout</a>
      </div>
    </div>
  </aside>

  <!-- CONTENT -->
  <main class="content">

    <!-- TOP BAR -->
    <div class="topbar mb-3">
      <div>
        <div class="fw-black" style="font-weight:900; font-size:18px;">‚ö° Admin Dashboard</div>
        <div class="text-muted" style="font-size:12px;">Monitor customers, manage network, import data.</div>
      </div>

      <div class="user-chip">
        <div class="avatar">{{ (username or 'A')[0]|upper }}</div>
        <div class="meta">
          <div class="name">{{ username }}</div>
          <div class="role">Role: {{ session.get('role') }}</div>
        </div>
      </div>
    </div>

    <!-- KPI ROW -->
    <div class="row g-3 mb-3">
      <div class="col-md-4 col-xl-2">
        <div class="kpi active" onclick="window.location='{{ url_for('list_customers', status='active') }}'">
          <div class="label">ACTIVE</div>
          <div class="value">{{ active_users }}</div>
          <div class="hint">Currently online</div>
        </div>
      </div>
      <div class="col-md-4 col-xl-2">
        <div class="kpi grace" onclick="window.location='{{ url_for('list_customers', status='grace') }}'">
          <div class="label">GRACE</div>
          <div class="value">{{ grace_users }}</div>
          <div class="hint">Day 31‚Äì33</div>
        </div>
      </div>
      <div class="col-md-4 col-xl-2">
        <div class="kpi suspended" onclick="window.location='{{ url_for('list_customers', status='suspended') }}'">
          <div class="label">SUSPENDED</div>
          <div class="value">{{ suspended_users }}</div>
          <div class="hint">Blocked accounts</div>
        </div>
      </div>
      <div class="col-md-6 col-xl-3">
        <div class="kpi pending" onclick="window.location='{{ url_for('list_customers', status='pending_router') }}'">
          <div class="label">PENDING ROUTER</div>
          <div class="value">{{ pending_router_users }}</div>
          <div class="hint">Assign router needed</div>
        </div>
      </div>
      <div class="col-md-6 col-xl-3">
        <div class="kpi total" onclick="window.location='{{ url_for('list_customers') }}'">
          <div class="label">TOTAL CUSTOMERS</div>
          <div class="value">{{ total_users }}</div>
          <div class="hint">All records</div>
        </div>
      </div>
    </div>

    <!-- MAIN GRID -->
    <div class="row g-3">
      <!-- LEFT: Work panels -->
      <div class="col-lg-8">

        <!-- Import Panel -->
        <div class="panel mb-3">
          <div class="panel-head">
            <h5>üì• Import Customers (Excel)</h5>
            <span class="badge text-bg-light" style="border:1px solid var(--line);">.xlsx / .xls</span>
          </div>
          <div class="panel-body">
            <p class="text-muted mb-2" style="font-size:13px;">
              Upload Excel. Branch & Router IP will be read from the sheet. If router not found, customer becomes <b>pending_router</b>.
            </p>

            <form action="{{ url_for('import_customers') }}" method="POST" enctype="multipart/form-data" class="row g-2">
              <div class="col-md-8">
                <input type="file" name="excel_file" class="form-control" required>
              </div>
              <div class="col-md-4 d-grid">
                <button class="btn btn-success btn-soft">Upload Excel</button>
              </div>
            </form>

            <!-- Flash messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                <div class="mt-3">
                  {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category=='error' else category }} mb-2">
                      {{ message }}
                    </div>
                  {% endfor %}
                </div>
              {% endif %}
            {% endwith %}
          </div>
        </div>

        <!-- Network Quick Actions -->
        <div class="panel">
          <div class="panel-head">
            <h5>üñß Network (Branch & Routers)</h5>
          </div>
          <div class="panel-body">
            <div class="row g-2">
              <div class="col-md-6 d-grid">
                <a class="btn btn-info btn-soft" href="{{ url_for('add_branch') }}">üè¢ Add Branch</a>
              </div>
              <div class="col-md-6 d-grid">
                <a class="btn btn-secondary btn-soft" href="{{ url_for('add_router') }}">üñß Add Router</a>
              </div>
              <div class="col-md-6 d-grid">
                <a class="btn btn-outline-info btn-soft" href="{{ url_for('list_branches') }}">üè¢ View Branches</a>
              </div>
              <div class="col-md-6 d-grid">
                <a class="btn btn-outline-secondary btn-soft" href="{{ url_for('list_routers') }}">üñß View Routers</a>
              </div>
            </div>
          </div>
        </div>

      </div>

      <!-- RIGHT: Quick panels -->
      <div class="col-lg-4">

        <!-- Quick Actions -->
        <div class="panel mb-3">
          <div class="panel-head">
            <h5>‚öôÔ∏è Quick Actions</h5>
          </div>
          <div class="panel-body d-grid gap-2">
            <a href="{{ url_for('add_customer') }}" class="btn btn-success btn-soft">‚ûï Add Customer</a>
            <a href="{{ url_for('list_customers') }}" class="btn btn-primary btn-soft">üìã View Customers</a>
            <a href="{{ url_for('admin_users') }}" class="btn btn-dark btn-soft">üë• Manage Staff</a>
            <a href="{{ url_for('monthly_report') }}" class="btn btn-danger btn-soft">üìä Reports</a>
          </div>
        </div>

        <!-- Notes / System Info -->
        <div class="panel">
          <div class="panel-head">
            <h5>üß† System Notes</h5>
          </div>
          <div class="panel-body">
            <ul class="text-muted" style="font-size:13px; padding-left: 18px; margin:0;">
              <li>Customers with missing router become <b>pending_router</b>.</li>
              <li>Grace applies on day 31‚Äì33 (daily click required).</li>
              <li>Use Reports to review monthly stats.</li>
            </ul>
          </div>
        </div>

      </div>
    </div>

    <footer>
      &copy; {{ datetime.utcnow().year }} My ISP System
    </footer>

  </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>