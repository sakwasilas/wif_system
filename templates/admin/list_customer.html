{% extends "base.html" %}

{% block content %}
<div class="container mt-4">

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert" id="flash-message">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <!-- Back to Dashboard -->
    <div class="mb-3">
        <a href="{{ url_for('admin_dashboard') }}" class="btn btn-outline-dark btn-sm">â¬… Back to Dashboard</a>
    </div>

    <h2>Customer List</h2>

    <table class="table table-striped table-bordered shadow-sm">
        <thead class="table-dark">
            <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Email</th>
                <th>Location</th>
                <th>Ip address</th>
                <th>Billing Amount</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for customer in customers %}
            <tr>
                <td>{{ customer.name }}</td>
                <td>{{ customer.phone }}</td>
                <td>{{ customer.email }}</td>
                <td>{{ customer.location }}</td>
                <td>{{ customer.ip_address }}</td>
            
                <td>{{ customer.billing_amount }}</td>
                <td>
                    {% if customer.status == "active" %}
                        <span class="badge bg-success">Active</span>
                    {% elif customer.status == "grace" %}
                        <span class="badge bg-warning">Grace</span>
                    {% else %}
                        <span class="badge bg-danger">Suspended</span>
                    {% endif %}
                </td>
                <td>
                    <!-- WiFi Access -->
                    <a href="{{ url_for('wifi_home', ip_address=customer.ip_address) }}" 
                       class="btn btn-primary btn-sm">WiFi Access</a>

                    <!-- Edit -->
                    <a href="{{ url_for('edit_customer', customer_id=customer.id) }}" 
                       class="btn btn-warning btn-sm">Edit</a>

                    <!-- Mark Paid -->
                    <form method="POST" 
                          action="{{ url_for('mark_paid', ip_address=customer.ip_address) }}" 
                          style="display:inline;">
                        <button type="submit" class="btn btn-success btn-sm">Paid</button>
                    </form>

                    <!-- Delete -->
                    <form method="POST" 
                          action="{{ url_for('delete_customer', customer_id=customer.id) }}" 
                          style="display:inline;"
                          onsubmit="return confirm('Are you sure you want to delete this customer?');">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <!-- Pagination -->
    <div class="mt-3">
        {% if page > 1 %}
            <a href="{{ url_for('list_customers', page=page-1) }}" class="btn btn-secondary">Previous</a>
        {% endif %}
        {% if has_next %}
            <a href="{{ url_for('list_customers', page=page+1) }}" class="btn btn-secondary">Next</a>
        {% endif %}
    </div>
</div>

<!-- Flash message auto-dismiss -->
<script>
    setTimeout(() => {
        const flash = document.getElementById("flash-message");
        if (flash) {
            flash.classList.remove("show");
        }
    }, 3000); // disappears after 3 seconds
</script>
{% endblock %}
