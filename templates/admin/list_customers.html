<!-- templates/admin/_customer_table.html -->
<div class="table-responsive">
    <table id="customersTable" class="table table-striped table-bordered shadow-sm table-hover align-middle text-center mb-0">
        <thead class="table-dark">
            <tr>
                <th>#</th>
                <th>Account No</th>
                <th>Name</th>
                <th>Amount Paid</th>
                <th>IP Address</th>
                <th>Phone</th>
                <th>Date Registered</th>
                <th>Status</th>
                <th>Location</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for customer in customers %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ customer.account_no }}</td>
                <td>{{ customer.name }}</td>
                <td>{{ customer.billing_amount }}</td>
                <td>{{ customer.ip_address }}</td>
                <td>{{ customer.phone }}</td>
                <td>{{ customer.start_date.strftime("%Y-%m-%d %H:%M:%S") if customer.start_date else '' }}</td>
                <td>
                    {% if customer.status == "active" %}
                        <span class="badge bg-success">Active</span>
                    {% elif customer.status == "grace" %}
                        <span class="badge bg-warning">Grace</span>
                    {% else %}
                        <span class="badge bg-danger">Suspended</span>
                    {% endif %}
                </td>
                <td>{{ customer.location }}</td>
                <td>
                    <div class="d-flex flex-nowrap justify-content-center gap-1 flex-wrap">
                        <a href="{{ url_for('edit_customer', customer_id=customer.id) }}" class="btn btn-warning btn-sm">Edit</a>
                        <form method="POST" action="{{ url_for('mark_paid', customer_id=customer.id) }}" class="d-inline">
                            <button type="submit" class="btn btn-success btn-sm">Paid</button>
                        </form>
                        <form method="POST" action="{{ url_for('delete_customer', customer_id=customer.id) }}" class="d-inline" onsubmit="return confirm('Are you sure?');">
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- DataTables Scripts -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>

<script>
$(document).ready(function() {
    $('#customersTable').DataTable({
        "paging": true,
        "searching": true,
        "ordering": true,
        "order": [[ 0, "asc" ]],
        "lengthMenu": [5, 10, 25, 50, 100],
        "columnDefs": [
            { "orderable": false, "targets": -1 } // Actions column not sortable
        ],
        "dom": 'Bfrtip',
        "buttons": [
            'copyHtml5',
            'excelHtml5',
            'csvHtml5'
        ]
    });
});
</script>
